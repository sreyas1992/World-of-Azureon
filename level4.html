<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 4: Echoes of The Spirit Tree - Guardians of Azureon</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Text', serif;
            background: url('Echoes of the spirit tree.png') center/contain no-repeat fixed;
            background-color: #0a2a0a;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #e8f4e8;
            position: relative;
            overflow-x: hidden;
        }

        /* Light overlay for better text readability */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(10,42,10,0.3), rgba(26,74,26,0.2), rgba(45,74,45,0.2));
            z-index: 1;
        }

        .container {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 900px;
            padding: 40px;
            background: rgba(0,0,0,0.6);
            border-radius: 20px;
            border: 3px solid #90EE90;
            box-shadow: 0 0 50px rgba(144, 238, 144, 0.8);
            margin: 20px;
        }

        /* Title Styling */
        .level-title {
            font-family: 'Cinzel', serif;
            font-size: 3.5em;
            color: #90EE90;
            text-shadow: 0 0 30px rgba(144, 238, 144, 0.8), 0 0 60px rgba(152, 251, 152, 0.6);
            margin-bottom: 10px;
            animation: spiritGlow 3s ease-in-out infinite alternate;
        }

        .level-subtitle {
            font-family: 'Cinzel', serif;
            font-size: 1.5em;
            color: #98FB98;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(152, 251, 152, 0.7);
        }

        @keyframes spiritGlow {
            0% { text-shadow: 0 0 30px rgba(144, 238, 144, 0.8), 0 0 60px rgba(152, 251, 152, 0.6); }
            100% { text-shadow: 0 0 40px rgba(144, 238, 144, 1), 0 0 80px rgba(152, 251, 152, 0.8); }
        }

        /* Fantasy Writeup */
        .story-section {
            background: rgba(144, 238, 144, 0.1);
            border: 2px solid #90EE90;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            text-align: left;
        }

        .story-text {
            font-size: 1.2em;
            line-height: 1.7;
            color: #e8f4e8;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
            margin-bottom: 15px;
        }

        .quest-objective {
            background: rgba(255, 69, 0, 0.2);
            border: 2px solid #FF4500;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.1em;
            color: #FFB347;
            font-weight: 600;
        }

        /* Score Display */
        .score-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .score-panel {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .score-panel h4 {
            font-family: 'Cinzel', serif;
            color: #FFD700;
            margin: 0 0 10px 0;
            font-size: 1.2em;
        }

        .score-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #FFFFFF;
        }

        /* Relic Display */
        .relic-section {
            background: rgba(144, 238, 144, 0.2);
            border: 2px solid #90EE90;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }

        .relic-section h3 {
            font-family: 'Cinzel', serif;
            color: #90EE90;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .relic-display {
            display: flex;
            justify-content: center;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .relic-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 2px solid #90EE90;
            min-width: 120px;
            transition: all 0.3s ease;
        }

        .relic-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(144, 238, 144, 0.3);
        }

        .relic-icon {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
        }

        .relic-name {
            color: #98FB98;
            font-weight: 600;
            font-size: 1.1em;
            font-family: 'Cinzel', serif;
        }

        .relic-status {
            color: #FFD700;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .no-relics {
            color: #FF6B6B;
            font-style: italic;
            padding: 20px;
            background: rgba(255, 107, 107, 0.1);
            border: 2px solid #FF6B6B;
            border-radius: 10px;
        }

        /* Start Quest Button */
        .quest-button {
            background: linear-gradient(135deg, #228B22, #32CD32, #90EE90);
            border: none;
            border-radius: 15px;
            padding: 25px 50px;
            font-family: 'Cinzel', serif;
            font-size: 1.5em;
            font-weight: 600;
            cursor: pointer;
            color: #fff;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
            box-shadow: 0 0 30px rgba(144, 238, 144, 0.6);
            transition: all 0.3s ease;
            margin: 30px 10px;
            text-decoration: none;
            display: inline-block;
            animation: questPulse 2s infinite ease-in-out;
        }

        .quest-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 50px rgba(144, 238, 144, 0.8);
            background: linear-gradient(135deg, #32CD32, #7CFC00, #98FB98);
            animation: none;
        }

        @keyframes questPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(144, 238, 144, 0.6); }
            50% { box-shadow: 0 0 40px rgba(144, 238, 144, 0.9); }
        }

        /* Navigation */
        .navigation {
            margin-top: 20px;
        }

        .nav-button {
            background: linear-gradient(135deg, #4a4a4a, #666);
            border: 2px solid #888;
            border-radius: 10px;
            padding: 12px 25px;
            font-family: 'Cinzel', serif;
            font-size: 1em;
            cursor: pointer;
            color: #e8e3d3;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }

        .nav-button:hover {
            background: linear-gradient(135deg, #666, #888);
            transform: translateY(-2px);
        }

        /* Mystical decorations */
        .spirit-decoration {
            font-size: 2em;
            margin: 0 15px;
            animation: spiritFlicker 2s ease-in-out infinite alternate;
        }

        @keyframes spiritFlicker {
            0% { opacity: 0.7; transform: scale(1); filter: hue-rotate(0deg); }
            100% { opacity: 1; transform: scale(1.1); filter: hue-rotate(90deg); }
        }

        /* Floating particles */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #90EE90;
            border-radius: 50%;
            pointer-events: none;
            animation: float 8s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
            50% { transform: translateY(-30px) rotate(180deg); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Title Section -->
        <div class="spirit-decoration">🌳</div>
        <h1 class="level-title">Echoes of The Spirit Tree</h1>
        <div class="spirit-decoration">🌳</div>
        <div class="level-subtitle">🌿 The Final Quest 🌿</div>

        <!-- Fantasy Writeup -->
        <div class="story-section">
            <div class="story-text">
                In the heart of the ancient grove stands the <strong>Great Spirit Tree of Azureon</strong>, the mystical guardian that has protected the realm for a thousand years. But darkness has crept into its roots, and the tree's divine light grows dimmer with each passing moment.
            </div>
            <div class="story-text">
                The fate of all Azureon now rests in your hands, brave Guardian. Armed with the knowledge gained from your previous quests and the power of any relics you've gathered, you must perform the ancient ritual of revival before the tree's spirit fades forever.
            </div>
            <div class="quest-objective">
                ⚡ <strong>FINAL CHALLENGE:</strong> Restore the Spirit Tree's power within 60 seconds to save Azureon from eternal darkness!
            </div>
        </div>

        <!-- Score Carryforward -->
        <div class="score-section">
            <div class="score-panel">
                <h4>🏆 Player Achievement</h4>
                <div class="score-value" id="playerScore">Loading...</div>
            </div>
            <div class="score-panel">
                <h4>👑 Kingdom Glory</h4>
                <div class="score-value" id="kingdomScore">Loading...</div>
            </div>
            <div class="score-panel">
                <h4>💖 Lives Remaining</h4>
                <div class="score-value" id="livesCount">Loading...</div>
            </div>
        </div>

        <!-- Relic Display -->
        <div class="relic-section">
            <h3>🔮 Mystical Relics Collected</h3>
            <div class="relic-display" id="relicDisplay">
                <!-- Relics will be loaded dynamically -->
            </div>
        </div>

        <!-- Start Quest Button -->
        <a href="#" class="quest-button" id="startQuestButton">
            🌟 Begin Final Quest 🌟
        </a>

        <!-- Navigation -->
        <div class="navigation">
            <a href="level3_complete.html" class="nav-button">← Return to Level 3</a>
            <a href="level1.html" class="nav-button">🔄 Restart Adventure</a>
        </div>
    </div>

    <script>
        // Get data from previous levels
        function getPreviousLevelData() {
            const urlParams = new URLSearchParams(window.location.search);
            
            return {
                playerScore: parseInt(urlParams.get('playerScore')) || parseInt(localStorage.getItem('azureon_score')) || 0,
                kingdomScore: parseInt(urlParams.get('kingdomScore')) || parseInt(localStorage.getItem('kingdomScore')) || 0,
                lives: parseInt(urlParams.get('lives')) || parseInt(localStorage.getItem('azureon_lives')) || 3,
                hasForestRelic: urlParams.get('forestRelic') === 'true' || localStorage.getItem('azureon_forest_relic') === 'true',
                hasEmberRelic: urlParams.get('emberRelic') === 'true' || localStorage.getItem('azureon_ember_relic') === 'true',
                characterChoice: urlParams.get('character') || localStorage.getItem('characterChoice') || 'boy'
            };
        }

        // Display carried forward data
        function displayGameData() {
            const data = getPreviousLevelData();
            
            // Update score displays
            document.getElementById('playerScore').textContent = data.playerScore.toLocaleString();
            document.getElementById('kingdomScore').textContent = data.kingdomScore.toLocaleString();
            document.getElementById('livesCount').textContent = data.lives;

            // Display collected relics
            const relicDisplay = document.getElementById('relicDisplay');
            relicDisplay.innerHTML = '';

            let hasAnyRelic = false;

            if (data.hasForestRelic) {
                relicDisplay.innerHTML += `
                    <div class="relic-item">
                        <div class="relic-icon">🌿</div>
                        <div class="relic-name">Forest Relic</div>
                        <div class="relic-status">✨ Collected</div>
                    </div>
                `;
                hasAnyRelic = true;
            }

            if (data.hasEmberRelic) {
                relicDisplay.innerHTML += `
                    <div class="relic-item">
                        <div class="relic-icon">🔥</div>
                        <div class="relic-name">Ember Relic</div>
                        <div class="relic-status">✨ Collected</div>
                    </div>
                `;
                hasAnyRelic = true;
            }

            if (!hasAnyRelic) {
                relicDisplay.innerHTML = `
                    <div class="no-relics">
                        <div class="relic-icon">❌</div>
                        <div>No mystical relics have been collected.</div>
                        <div style="font-size: 0.9em; margin-top: 10px;">
                            The final quest will be more challenging without relic power!
                        </div>
                    </div>
                `;
            }

            // Update start quest button with data
            const startButton = document.getElementById('startQuestButton');
            const gameParams = new URLSearchParams({
                playerScore: data.playerScore,
                kingdomScore: data.kingdomScore,
                lives: data.lives,
                forestRelic: data.hasForestRelic,
                emberRelic: data.hasEmberRelic,
                waterRelic: data.hasWaterRelic,
                character: data.characterChoice
            });
            
            // TODO: Replace with actual Level 4 game page when created
            startButton.href = `level4_game.html?${gameParams.toString()}`;
        }

        // Create floating spirit particles
        function createSpiritParticle() {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * window.innerWidth + 'px';
            particle.style.top = window.innerHeight + 'px';
            particle.style.animationDelay = Math.random() * 2 + 's';
            document.body.appendChild(particle);

            // Remove particle after animation
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 8000);
        }

        // Initialize page
        displayGameData();

        // Create mystical atmosphere with floating particles
        setInterval(createSpiritParticle, 1000);

        // Add some initial particles
        for (let i = 0; i < 5; i++) {
            setTimeout(createSpiritParticle, i * 500);
        }
    </script>
</body>
</html>